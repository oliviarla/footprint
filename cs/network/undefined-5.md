# 이중화

## 개요

* 인프라를 구성하는 각 요소를 여러 개 이상으로 구성하여, 특정 인프라에 문제가 발생하더라도 이중화된 다른 인프라를 통해 서비스가 지속되도록 한다.
* 즉, SPoF를 최소화하여 높은 가용성과 Fault-Tolerance를 제공하도록 한다.
* 서비스에 필요한 출발 지점부터 끝 지점까지 모든 인프라에 이중화 구성을 고려해야 한다.
  * 물리적 또는 가상 머신 서버, 서버와 네트워크 장비를 구성해주는 인터페이스, 서버에 연결된 스위치, 다수 서버의 부하 분산을 위한 L4/L7 스위치, 방화벽, 인터넷 게이트웨이, 인터넷 회선 등 인프라의 모든 요소
  * 데이터 센터 자체도 이중화하기 위해 DR 센터(Disaster Recovery Center, 재해복구센터)나 액티브-액티브 데이터 센터를 구축한다.
* 각 구성 요소가 동시에 운영 중인 상태로 운영하는 Active-Active 방식을 사용하거나, 하나는 대기 상태로 있다가 장애가 발생 시 운영 상태로 전환하는 Active-Standby 방식을 사용할 수 있다.
* 인프라의 이중화를 구성할 때는 이중화된 인프라 중 일부에서 장애가 발생하더라도 정상적인 서비스에 문제가 없도록 용량을 산정해 설계해야 한다.
  * 예를 들어 12G 트래픽을 처리해야 하는 경우, 10G 네트워크 카드 2개를 Active-Active로 이중화해두기만 하면 하나의 네트워크 카드에서 장애가 발생했을 때 서비스에 문제가 생긴다. 따라서 하나에 장애가 발생하더라도 문제 없도록 설계해야 한다.

## LACP

* Link Aggregation Control Protocol
* 대역폭 확장을 통해 링크 사용률 향상(Improved Utilization of Available Link), 향상된 장애 회복(Improved Resilience) 기능을 제공한다.
* 두 개 이상의 물리 인터페이스로 구성된 논리 인터페이스를 이용해 모든 물리 인터페이스를 액티브 상태로 사용한다.
* 스위치 <-> 스위치, 스위치 <-> 서버 간의 네트워크 대역폭이 확장된다.
* 액티브-액티브 상태이므로 인터페이스 절체로 인한 지연 없이 서비스를 제공할 수 있으며, LACP로 구성하는 논리 인터페이스의 대역폭을 서비스에 필요한 전체 트래픽 기준으로 산정하면 안된다.
* LACP로 구성하는 물리 인터페이스들의 속도가 동일해야 한다.

### 동작 방식

* LACP를 통해 장비 간 논리 인터페이스를 구성하기 위해 LACPDU(LACP Data Unit)라는 프레임을 사용한다.
* LACP가 연결되려면 LACPDU를 주고받는 장비가 한 장비여야 한다. 두 개 이상의 물리 인터페이스는 한 장비에 연결되어야 한다.













